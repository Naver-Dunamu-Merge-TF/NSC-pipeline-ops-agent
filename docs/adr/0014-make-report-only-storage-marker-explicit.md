# ADR-0014: Make report_only storage marker explicit

## Created At

2026-02-23 22:53 KST

## Status

Confirmed

## Context

`i-4oua`에서 report_only 실행 경로는 결과 아티팩트를 로그에만 남기고 파일이나 체크포인트에는 저장하지 않는 운영 정책을 따르지만, 페이로드 자체에는 저장 매체 의도가 명시적으로 드러나지 않아 후속 소비자와 검증 단계에서 해석 차이가 발생할 여지가 있었다.

## Decision

report_only 페이로드에 `report_artifact_storage: "log_only"` 마커를 명시적으로 추가하고 저장 매체 정책은 기존과 동일하게 로그 전용으로 유지하기로 결정한다.

저장 매체를 파일/체크포인트로 확장하는 변경은 즉시 수행하지 않고, 아래 재평가 트리거와 이행 기준을 만족할 때만 별도 이슈로 진행한다.

## Rationale

대안 1은 마커를 추가하지 않고 문서와 관례로만 로그 전용 정책을 전달하는 방식이었지만, 페이로드 단독 해석 시 정책 추론이 필요해져 구현체 간 불일치 위험이 커지므로 기각했다.

대안 2는 report_only에서도 파일 또는 체크포인트 영속화를 허용하는 방식이었지만, 현재 단계에서는 운영 복잡도와 상태 관리 비용을 즉시 증가시키는 반면 실질 요구가 확인되지 않았기 때문에 해당 영속화 확장은 추후 필요가 명확해질 때까지 유예했다.

최종 선택은 스키마에 작은 명시 신호를 추가해 호환성을 유지하면서도 의도 전달과 검증 가능성을 높이는 절충안이며, 정책 자체를 변경하지 않아 기존 log-only 운영 특성을 보존한다.

파일/체크포인트 확장 유예의 재평가 트리거는 다음과 같이 정의한다.

- 감사 요구: 로그만으로 감사 증적(원본 payload 재현, 변경 불가 보관, 추적성)을 충족하지 못하는 사례가 확인될 때
- 보존 기간: report_only payload 보존/조회 요구가 로그 보존 정책의 기간 또는 검색 SLA를 초과할 때
- 재처리 시나리오: 과거 incident payload 기반 재처리가 반복적으로 요구되고 로그 재수집만으로 재현 가능한 운영 절차를 유지할 수 없을 때

트리거 충족 시 이행 기준은 다음 순서를 모두 만족해야 한다.

1. **상태 계약 변경 범위 확정**: AgentState에 저장 포인터를 추가할지, `final_status` 의미를 유지할지, 하위 호환 정책을 먼저 문서화한다.
2. **저장 경로 및 수명주기 확정**: 파일/체크포인트 경로 규칙(권한, 네이밍, 보존/파기, 접근 주체)을 운영 문서와 함께 고정한다.
3. **테스트/검증 게이트 추가**: `report_artifact_storage` 정책 테스트를 `log_only` 고정에서 확장 정책으로 갱신하고, 경계 케이스/회귀 테스트를 CI에 추가한다.
4. **문서 동기화 완료**: `.specs/ai_agent_spec.md`의 report_only 저장 매체 절과 본 ADR을 동일 기준으로 동기화한 뒤 구현 PR을 진행한다.
