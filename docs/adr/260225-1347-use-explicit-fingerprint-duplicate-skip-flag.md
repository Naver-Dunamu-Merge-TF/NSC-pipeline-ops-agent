# ADR-260225-1347: 탐지 노드에서 명시적 fingerprint_duplicate 스킵 플래그 사용

## Created At

2026-02-25 13:47 KST

## Status

Confirmed

## Context

DEV-016 구현 과정에서 중복 fingerprint로 판단된 incident는 시작하지 않거나 즉시 스킵되어야 한다는 요구가 확인되었다. 관련 요구는 `.specs/ai_agent_spec.md` §2.3에 명시되어 있으나, 현재 코드베이스의 detect 노드 내부에는 중복 여부를 조회할 수 있는 구체적인 dedupe lookup 인터페이스가 제공되지 않는다. 따라서 기존 흐름을 크게 변경하지 않으면서도 스펙 요구를 즉시 충족할 수 있는 최소 영향의 실행 기준이 필요했다.

## Decision

DEV-016에서는 detect 노드가 상태의 `fingerprint_duplicate=True`를 확인하면 즉시 short-circuit하여 해당 incident 시작을 건너뛰도록 결정한다.

## Rationale

선택한 접근은 현재 구조에서 추가 인터페이스 도입 없이 스펙 요구를 빠르게 충족하고, detect 단계의 책임 경계를 유지하면서 변경 범위를 최소화할 수 있다는 점에서 적합하다.

기각한 대안 1은 detect 노드 내부에 신규 dedupe lookup 인터페이스를 설계·주입하는 방식이다. 장점은 중복 판단 근거를 노드 내부에서 직접 확인할 수 있어 설계 일관성이 높아질 수 있다는 점이다. 단점은 인터페이스 계약, 의존성 주입 경로, 테스트 경계까지 함께 확장해야 하므로 DEV-016 범위를 넘어서는 구조 변경과 일정 리스크가 커진다는 점이다.

기각한 대안 2는 중복 여부를 detect 이후 단계에서 처리하는 방식이다. 장점은 detect 노드 변경을 줄일 수 있다는 점이다. 단점은 이미 시작된 실행을 뒤늦게 취소하는 형태가 되어 `.specs/ai_agent_spec.md` §2.3의 "시작하지 않거나 즉시 스킵" 의도와 정합성이 떨어지고, 불필요한 처리 비용이 발생할 수 있다는 점이다.

기각한 대안 3은 상태 플래그 없이 런타임 예외를 발생시켜 중단하는 방식이다. 장점은 구현이 단순해 보일 수 있다는 점이다. 단점은 정상 제어 흐름을 예외로 표현하게 되어 운영 가시성과 테스트 명확성이 낮아지고, 의도된 스킵과 실제 오류를 구분하기 어려워진다는 점이다.
