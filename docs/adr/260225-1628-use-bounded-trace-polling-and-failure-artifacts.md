# ADR-260225-1628: use-bounded-trace-polling-and-failure-artifacts

## Created At

2026-02-25 16:28 KST

## Status

Confirmed

## Context

DEV-044 스모크 검증에서 수집 API가 202로 수락된 직후 트레이스 조회가 지연될 수 있어, 즉시 단건 조회만 수행하면 실제 저장 성공 케이스를 실패로 오판할 위험이 있었다. 또한 운영 증적 요구사항상 실패 시점(시크릿 조회 실패, 롤아웃 실패 등)에서도 동일한 JSON 라인 아티팩트를 남겨야 후속 분석과 티켓 증빙이 가능하다. 따라서 조회 지연 허용과 실패 증적 일관성을 동시에 보장하는 최소 규칙이 필요해졌다.

## Decision

트레이스 조회는 재시도 횟수와 간격이 고정된 bounded retry/poll 방식으로 수행하고, 모든 실패 분기에서 stage가 명시된 JSON 아티팩트를 출력하도록 결정한다.

## Rationale

대안 1(즉시 1회 조회 후 실패 처리)은 구현이 가장 단순하지만 비동기 반영 지연 구간에서 오탐 실패를 유발해 DEV-044 E2E 증적 신뢰도를 떨어뜨려 기각했다. 대안 2(무제한 폴링)는 오탐은 줄일 수 있으나 실행 시간이 비결정적으로 늘어나 스모크 성격과 운영 안정성에 맞지 않아 기각했다. 대안 3(일부 실패만 아티팩트 출력)은 구현 비용은 낮지만 장애 원인 구간별 증적 일관성이 깨져 티켓/감사 추적성이 약해져 기각했다. 선택한 방식은 실행 시간을 예측 가능하게 유지하면서도 비동기 반영 지연을 흡수하고, 실패 유형별 stage를 남겨 운영 triage를 단순화하는 균형점이다.
