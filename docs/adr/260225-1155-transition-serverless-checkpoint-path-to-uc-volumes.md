# ADR-260225-1155: transition-serverless-checkpoint-path-to-uc-volumes

## Created At

2026-02-25 11:55 KST

## Status

Confirmed

## Context

i-qva6 범위의 Task 5에서는 서버리스 체크포인트 기본 경로 정책을 재정의해야 했다. 선행 결정인 ADR-260225-1012와의 관계를 유지하면서도, 실제 실행 근거에서 `/dbfs` 기본 경로가 서버리스 환경에서 반복 실패함이 확인되었다. Task 1 (Red) 증거로 parent run `984766072187352` 및 task run `855119301772499`에서 `Errno5`와 함께 `/dbfs` 경로 실패가 재현되었다. 반면 Task 3 (Green) 증거로 parent run `13678539349295` 및 task run `343354156937909`에서는 `/Volumes` 경로에서 체크포인트 기록이 정상 성공했다.

## Decision

서버리스 기본 체크포인트 경로를 `/dbfs`에서 `/Volumes/nsc_dbw_dev_7405610275478542/default/agent_state_checkpoints/agent.db`로 전환하고 체크포인트 엔진(SQLite)은 변경하지 않기로 결정한다.

## Rationale

실패/성공 실행 근거가 동일 워크플로에서 명확히 갈리므로 기본 경로만 전환하는 것이 i-qva6 범위에서 가장 작은 변경으로 효과를 확보한다.

검토했지만 기각한 대안은 다음과 같다.
- 대안 1: `/dbfs` 기본값을 유지하고 런타임별 예외 처리를 추가한다. 기각 이유: `Errno5`가 이미 반복 확인되어 기본값 유지 시 실패 경로를 지속 고착시키며 운영 복잡도만 증가한다.
- 대안 2: SQLite를 폐기하고 다른 체크포인트 엔진으로 교체한다. 기각 이유: 현재 문제는 엔진 자체가 아니라 서버리스 기본 경로 부적합이며, 엔진 교체는 i-qva6 범위를 넘어서는 과도한 변경이다.
- 대안 3: `/dbfs`와 `/Volumes`를 동시 기본값으로 두는 혼합 전략을 적용한다. 기각 이유: 기본 정책이 모호해지고 장애 분석 기준이 약화되어 ADR-260225-1012 이후의 추적 가능성이 떨어진다.

## Consequence

명시적 기본 경로가 고정되어 서버리스 실행의 재현성과 운영 일관성이 높아지며, SQLite 엔진 유지로 i-qva6 범위를 벗어나는 마이그레이션 부담 없이 경로 정책 전환 효과를 확보한다.

시간 우선 결정에 따라 후속 하드닝 항목은 별도 이슈 분리 없이 운영 관찰 항목으로 관리한다.
