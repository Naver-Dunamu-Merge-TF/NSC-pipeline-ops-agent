# ADR-0009: bad_records_summary 크기 상한 및 절단 정책 고정

## Created At

2026-02-23 17:42 KST

## Status

PendingReview

## Context

DEV-015에서는 실패 레코드 요약(`bad_records_summary`)을 응답/로그에 함께 남겨 운영자가 원인 분류와 재현을 빠르게 할 수 있어야 한다.
하지만 요약 데이터 크기에 제한이 없으면 에러 페이로드가 입력 분포에 따라 급증해 전송 실패, 로그 과다 적재, 파싱 지연 같은 운영 리스크가 발생한다.
동일 입력에 대해 항상 같은 결과를 만들어야 디버깅과 회귀 비교가 가능하므로, 크기 제어 규칙도 결정론적으로 고정할 필요가 있다.

## Decision

`bad_records_summary`는 타입 수 상한, 타입별 샘플 수 상한, 문자열 필드 길이 상한을 하드 캡으로 고정하고 초과분은 정해진 절단 규칙으로 처리하는 방식으로 결정한다.

## Rationale

대안 1로 전체 요약을 무제한 보존하는 방안을 검토했지만, 장애 상황에서 페이로드 폭증으로 관측 파이프라인 안정성을 해칠 가능성이 높아 기각했다.
대안 2로 총 바이트 예산만 두고 동적으로 항목을 채우는 방안을 검토했지만, 입력 순서와 직렬화 조건에 따라 포함 항목이 달라져 동일 입력 재현성이 약해질 수 있어 기각했다.
대안 3로 무작위 샘플링을 검토했지만, 재실행마다 결과가 달라져 원인 추적과 회귀 비교가 어려워 기각했다.
최종안의 트레이드오프로 일부 상세 맥락은 잘릴 수 있지만, 크기 예측 가능성·전송 안정성·결과 결정성이 더 중요한 운영 요구이므로 수용한다.
