# ADR-0013: Confirm ActionPlan v2 contract for execute

## Created At

2026-02-23 22:34 KST

## Status

PendingReview

## Context

DEV-055에서 ActionPlan의 execute 경로를 v2 이상 버전에 대해 활성화하면서, 실행 전에 어떤 상위 필드 구성을 허용할지 명확히 고정할 필요가 생겼다. v2+는 에이전트 출력의 일관성과 운영 검증 가능성을 높이기 위해 `schema_version`, `action`, `parameters`를 필수로 요구하고, 선택 필드는 `expected_outcome`(문자열)과 `caveats`(문자열 리스트)로 제한하며, 이외의 미정의 상위 필드는 거부해야 한다. 반면 기존 v1(버전 미명시) 플로우는 이미 느슨한 상위 구조를 전제로 동작 중이므로, 동일한 엄격 검증을 즉시 적용하면 기존 호출과의 호환성이 깨질 수 있다.

## Decision

ActionPlan execute 경로는 v2 이상에 대해서만 상위 계약을 엄격히 적용하여 필수/선택 필드를 고정하고 미정의 상위 필드를 거부하되, v1(버전 미명시)은 기존의 완화된 상위 동작을 유지하기로 결정한다.

## Rationale

대안 1은 v1과 v2+ 모두에 엄격 상위 계약을 일괄 적용하는 방식으로, 규칙 단순화와 검증 일관성은 높지만 기존 v1 사용자의 입력이 대량으로 실패할 수 있어 즉시 적용 리스크가 크다. 대안 2는 v2+에서도 상위 필드를 계속 느슨하게 허용하는 방식으로, 단기 호환성은 좋지만 스키마 드리프트와 예기치 않은 필드 유입을 제어하기 어렵고 execute 안정성 목표와 충돌한다. 최종 선택안은 버전별 정책을 분리해 v2+에서 계약 엄격성을 확보하면서 v1 호환성을 보존하는 절충안으로, 검증 로직이 이원화되는 복잡도 비용이 생기지만 점진적 전환과 운영 안정성 측면에서 가장 실용적이다.
