# ADR-0022: use bounded retry and local smoke

## Created At

2026-02-25 01:08 KST

## Status

PendingReview

## Context

DEV-027 구현에서는 전송 경로의 신뢰성과 검증 재현성을 동시에 확보해야 했고, 장애 복구 지연과 외부 의존성으로 인한 테스트 변동성을 최소화할 필요가 있었다. 특히 일시적(Transient) 오류에 대해 무제한 재시도나 과도한 재시도는 처리 지연과 중복 부하를 유발할 수 있으며, 반대로 재시도가 없으면 단발성 네트워크 흔들림에도 실패가 고정되는 문제가 있었다. 또한 스모크 테스트는 실제 전송 경로를 확인해야 하지만 외부 SaaS를 직접 호출하면 네트워크/계정 상태에 따라 결과가 흔들려 개발 단계의 빠른 검증 목적과 충돌했다.

## Decision

DEV-027에서는 Transient 오류 재시도를 기본 2회(총 3회 시도)로 상한 설정하고, 스모크 테스트는 외부 SaaS 대신 로컬 임시 HTTP 서버로 실제 전송 경로를 검증하는 방식으로 결정한다.

## Rationale

첫째, 재시도 정책의 대안으로 무제한 재시도, 재시도 비활성화, 더 높은 고정 재시도 횟수(예: 5회 이상)를 검토했다. 무제한 재시도는 장애 상황에서 큐 적체와 지연 전파를 키우므로 기각했고, 재시도 비활성화는 일시적 오류 흡수 능력이 없어 운영 안정성이 떨어져 기각했다. 더 높은 고정 횟수는 성공률 이득 대비 지연과 중복 호출 비용이 커지는 저효율 구간으로 판단되어 기각했다.

둘째, 스모크 검증 대상의 대안으로 외부 SaaS 실환경 호출, 모킹 기반 단위 검증만 수행, 하이브리드(외부 호출 선택적 병행)를 검토했다. 외부 SaaS 실환경 호출은 실제성과는 높지만 개발 단계에서 계정/네트워크 상태에 따라 실패 원인 분리가 어렵고 재현성이 낮아 기각했다. 모킹만 사용하는 방식은 빠르지만 실제 HTTP 전송 경로를 끝까지 통과하는지 확인하지 못해 기각했다. 하이브리드는 운영 복잡도가 증가하고 DEV-027의 저영향·가역적 결정 범위를 넘어선다고 보아 기각했다.

결과적으로 기본 2회 재시도(총 3회 시도)와 로컬 임시 HTTP 서버 기반 스모크 검증 조합은 실패 흡수 능력, 실행 시간, 재현성, 의존성 관리 사이의 균형이 가장 좋고 필요 시 정책 조정이나 외부 연동 복귀가 쉬운 가역적 선택이다.
